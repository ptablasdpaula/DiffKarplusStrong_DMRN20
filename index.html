<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Differentiable Karplus-Strong</title>

  <!-- ======== SOCIAL / SEO ======== -->
  <meta name="description"  content="Differentiable Karplus-Strong – project page with audio examples and code links" />
  <meta property="og:title"        content="Differentiable Karplus-Strong" />
  <meta property="og:description"  content="Audio examples, paper and code for a differentiable, time-domain extended Karplus-Strong algorithm" />
  <meta property="og:url"          content="URL OF THE WEBSITE" />
  <meta property="og:image"        content="DiffKS.jpg" />
  <meta property="og:image:width"  content="1200" />
  <meta property="og:image:height" content="630" />
  <meta name="twitter:title"  content="Differentiable Karplus-Strong" />
  <meta name="twitter:image"  content="DiffKS.jpg" />
  <meta name="twitter:card"   content="summary_large_image" />
  <meta name="keywords"       content="audio synthesis, differentiable DSP, Karplus-Strong, gradient descent, autoencoder, DMRN+20" />

  <!-- fonts & icons (explicitly load 700 & 800 weights to guarantee bold) -->
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;700;800&family=Noto+Sans:wght@400;700;800&family=Castoro&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

  <!-- ======== STYLES ======== -->
  <style>
    body{font-family:'Google Sans','Noto Sans',Arial,sans-serif;line-height:1.6;color:#333;max-width:1200px;margin:0 auto;padding:20px}
    .container{max-width:900px;margin:0 auto;padding:0 20px}
    h1,h2,h3{text-align:center;margin-bottom:1.5rem}
    h1{color:#2c3e50;margin-bottom:2rem}
    h2{color:#34495e;margin-top:3rem;margin-bottom:2rem}
    .abstract{background:#f8f9fa;padding:2rem;border-radius:8px;margin:2rem 0;text-align:justify}

    table{border-collapse:collapse;width:100%;max-width:900px;margin:2rem auto;box-shadow:0 2px 8px rgba(0,0,0,.1);border-radius:8px;overflow:hidden}
    th,td{border:1px solid #e1e5e9;padding:10px;text-align:center}
    th{background:#f0f0f0;font-weight:600}

    .play-btn,.ctrl-btn{cursor:pointer;padding:6px 14px;background:#007BFF;color:#fff;border:none;border-radius:6px;font-size:15px;transition:.3s;box-shadow:0 2px 4px rgba(0,0,0,.1)}
    .play-btn:hover,.ctrl-btn:hover{transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,.15)}
    .waveform,.spectrogram{height:80px;background:#e8e8e8;margin:6px 0;border-radius:4px;border:1px solid #ddd}
    .controls{display:flex;justify-content:center;gap:6px;margin-bottom:10px}

    .playerHead{text-align:center;margin-top:3rem}
    .hero{margin:2rem 0}

    .button{display:inline-block;padding:10px 18px;text-decoration:none;border-radius:6px;transition:.3s}
    .is-dark{background:#2c3e50;color:#fff}
    .is-dark:hover{background:#34495e;transform:translateY(-1px)}

    .table-caption{max-width:900px;margin:0.5rem auto 0;text-align:center;font-size:0.9rem}

    .metrics th,.metrics td{font-size:14px}
    .metrics td strong,
    .metrics th strong,
    .metrics td span[style*="font-weight:700"]{font-weight:800 !important;}
  </style>
<script>
  window.MathJax = {
    tex: { inlineMath: [['\\(','\\)'], ['$', '$']] },
    svg: { fontCache: 'global' }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <!-- ===== HEADER ===== -->
  <section class="hero">
    <div class="hero-body">
      <div class="container is-max-desktop">
        <div class="columns is-centered"><div class="column has-text-centered">
          <h1 class="title is-1">Differentiable Karplus-Strong</h1>
          <div class="is-size-5">
            <span><a href="https://github.com/ptablasdpaula/" target="_blank">Pablo Tablas de Paula</a>, </span>
            <span><a href="https://github.com/davidmarttila" target="_blank">David Marttila</a>, </span>
            <span><a href="https://www.eecs.qmul.ac.uk/~josh/" target="_blank">Joshua D. Reiss</a></span><br>
            <span>Centre For Digital Music (C4DM), Queen Mary University Of London &middot; Digital Music Research Network One-day Workshop 2025</span>
          </div>
          <div style="margin-top:1rem">
            <a href="static/paper.pdf" target="_blank" class="button is-dark is-rounded"><i class="fas fa-file-pdf"></i>&nbsp;Paper</a>
            <a href="https://github.com/ptablasdpaula/DiffKarplusStrong_DMRN20" target="_blank" class="button is-dark is-rounded"><i class="fab fa-github"></i>&nbsp;Code</a>
          </div>
        </div></div>
      </div>
    </div>
  </section>

  <!-- ===== ABSTRACT & FIGURE ===== -->
  <section class="section hero is-light"><div class="container is-max-desktop">
    <h2 class="title is-3">Abstract</h2>
    <div class="abstract">
      <p>We present a differentiable, time-domain implementation of an extended Karplus-Strong Algorithm (KSA) that can be optimised end-to-end as a Differentiable DSP (DDSP) paradigm. We show its ability for instrument modelling by reconstructing an acoustic guitar dataset, where our proposed Gradient Descent (GD) baseline outperforms a Genetic Algorithm (GA).</p>
    </div>

    <img src="DiffKS.jpg" alt="Differentiable Karplus-Strong architecture" style="width:100%;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1)">
    <p class="table-caption"><strong>Figure 1:</strong> Proposed architecture, where coloured blocks are optimised by gradient descent. <em>Lagrange</em> is short for Lagrange interpolation, while <em>g</em> stands for gain stages.</p>

    <h2 class="title is-3">Gradient Descent vs. Genetic Algorithm</h2>

    <table>
      <caption class="table-caption"><strong>Table 1:</strong> Comparison of Gradient Descent and Genetic Algorithm baselines.</caption>
      <thead>
        <tr>
          <th>Baseline</th>
          <th>\(\mathcal{L}_{\mathrm{MSS}}\)</th>
          <th>MFCC</th>
          <th>Encodec</th>
          <th>MS-CLAP</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Gradient Descent</td>
          <td>0.79 &plusmn; 0.11</td>
          <td>2.32 &plusmn; 1.50</td>
          <td>19.89</td>
          <td>111.30</td>
        </tr>
        <tr>
          <td>Genetic Algorithm</td>
          <td>1.43 &plusmn; 0.31</td>
          <td>4.10 &plusmn; 1.75</td>
          <td>216.93</td>
          <td>346.93</td>
        </tr>
      </tbody>
    </table>

    <table>
      <caption class="table-caption"><strong>Table 2:</strong> \(\mathcal{L}_{\mathrm{MSS}}\) mean difference to overall mean (0.79) across MIDI velocities and octaves for our GD baseline. Negative values are better. "---" are excluded high-variance values.</caption>
      <thead>
        <tr>
          <th><small>\(\downarrow\) Oct. Vel. \(\rightarrow\)</small></th>
          <th>25</th>
          <th>50</th>
          <th>75</th>
          <th>100</th>
          <th>127</th>
          <th>mean</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>E2--E3</td>
          <td>+0.16</td>
          <td>&mdash;</td>
          <td>+0.17</td>
          <td>+0.11</td>
          <td>+0.15</td>
          <td>+0.13</td>
        </tr>
        <tr>
          <td>E3--E4</td>
          <td>-0.22</td>
          <td>&mdash;</td>
          <td>-0.21</td>
          <td>-0.11</td>
          <td>-0.10</td>
          <td>-0.15</td>
        </tr>
        <tr>
          <td>E4--E5</td>
          <td>-0.18</td>
          <td>+0.09</td>
          <td>+0.29</td>
          <td>-0.09</td>
          <td>-0.18</td>
          <td>-0.06</td>
        </tr>
        <tr>
          <td>E5--E6</td>
          <td>+0.18</td>
          <td>-0.12</td>
          <td>+0.21</td>
          <td>+0.06</td>
          <td>+0.03</td>
          <td>+0.08</td>
        </tr>
        <tr>
          <td><strong>mean</strong></td>
          <td>-0.02</td>
          <td>-0.15</td>
          <td>+0.11</td>
          <td>-0.01</td>
          <td>-0.03</td>
          <td>0.00</td>
        </tr>
      </tbody>
    </table>
  </div></section>

  <!-- ===== AUDIO EXAMPLES ===== -->
  <section class="hero is-small">
    <div class="hero-body">
      <div class="container" id="audio-section">
        <div class="playerHead">
          <h2 class="title is-4">Audio Examples</h2>
          <p>Columns correspond to <strong>Ground Truth</strong>, <strong>Gradient Descent</strong> and <strong>Genetic Algorithm</strong>.</p>
          <button class="button is-dark" id="shuffle-sounds">&#128256; Shuffle Examples</button>
        </div>
        <table id="table-sounds">
          <thead>
            <tr>
              <th>Ground Truth</th>
              <th>Gradient Descent</th>
              <th>Genetic Algorithm</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===== BIBTEX ===== -->
  <section class="section" id="BibTeX"><div class="container is-max-desktop content">
    <h2 class="title">BibTeX</h2>
    <p>If you use this work, please cite:</p>
    <p><em>Tablas de Paula, P., Marttila, D. and Reiss, J.D., 2025 December. Differentiable Karplus-Strong. In Digital music research network one-day workshop (DMRN+20).</em></p>
    <pre><code>@inproceedings{tablas2025diffks,
  title     = {Differentiable Karplus-Strong},
  author    = {Tablas de Paula, Pablo and Marttila, David and Reiss, Joshua D.},
  booktitle = {Digital Music Research Network One-day Workshop (DMRN+20)},
  year      = {2025},
  month     = dec
}</code></pre>
  </div></section>

  <!-- ===== FOOTER ===== -->
  <footer class="footer"><div class="container"><p style="text-align:center;font-size:0.85rem">&copy; 2025 Differentiable Karplus-Strong &mdash; built from the Academic Project Page template.</p></div></footer>

  <!-- ===== PLAYER & TABLE SCRIPT ===== -->
  <script type="module">
  import WaveSurfer from 'https://cdn.jsdelivr.net/npm/wavesurfer.js@7/dist/wavesurfer.esm.js';
  import Spectrogram from 'https://cdn.jsdelivr.net/npm/wavesurfer.js@7/dist/plugins/spectrogram.js';

  /* ---------- BASIC CONFIG ---------- */
  const AUDIO_EXT = '.wav';   // change if your files use another extension
  const ROWS      = 3;        // how many examples to show at once

  const PATH    = 'audio';
  const MODELS  = ['target','gradient','genetic'];
  const LABELS  = { target:'Ground Truth', gradient:'Gradient Descent', genetic:'Genetic Algorithm' };

  /* ---------- HELPERS ---------- */
  async function getIDs() {
    try {
      const r = await fetch(`${PATH}/index.json`, { cache:'no-store' });
      return r.ok ? (await r.json()).samples : [];
    } catch {
      return [];
    }
  }

  const rand = (arr, n) => arr.slice().sort(() => 0.5 - Math.random()).slice(0, Math.min(n, arr.length));
  const icon = (btn, on) => { btn.innerHTML = on ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>'; };

  async function filterValid(ids) {
    const checks = ids.map(async id => {
      for (const m of MODELS) {
        const url  = `${PATH}/${m}/${id}${AUDIO_EXT}`;
        const resp = await fetch(url, { method:'HEAD' });
        if (!resp.ok) return null;           // if any model missing → drop this id
      }
      return id;
    });
    return (await Promise.all(checks)).filter(Boolean);
  }

  /* ---------- PLAYER CACHE ---------- */
  const players = new Map();

  function makePlayer(td, url) {
    const wf = td.querySelector('.waveform');
    const sp = td.querySelector('.spectrogram');
    const ws = WaveSurfer.create({
      container: wf,
      backend: 'MediaElement',
      height: 80,
      waveColor: '#999',
      progressColor: '#007BFF',
      plugins: [
        Spectrogram.create({ container: sp, scale: 'mel', labels: false, height: 80 })
      ]
    });
    ws.load(url);
    return ws;
  }

  function renderRows(ids) {
    const tbody = document.querySelector('#table-sounds tbody');
    tbody.innerHTML = '';

    // destroy old players
    players.forEach(ws => ws.destroy());
    players.clear();

    ids.forEach(id => {
      const row = document.createElement('tr');
      row.dataset.sample = id;

      MODELS.forEach(m => {
        const td = document.createElement('td');
        td.innerHTML = `
          <div class="controls">
            <button class="play-btn"><i class="fas fa-play"></i></button>
            <button class="ctrl-btn" data-act="stop"><i class="fas fa-stop"></i></button>
            <button class="ctrl-btn" data-act="rew"><i class="fas fa-backward"></i></button>
          </div>
          <div class="waveform"></div>
          <div class="spectrogram"></div>`;

        const url  = `${PATH}/${m}/${id}${AUDIO_EXT}`;
        const ws   = makePlayer(td, url);
        const play = td.querySelector('.play-btn');
        const stop = td.querySelector('[data-act="stop"]');
        const rew  = td.querySelector('[data-act="rew"]');

        play.onclick = () => {
          // pause all others
          players.forEach((other, btn) => {
            if (other.isPlaying()) { other.pause(); icon(btn, false); }
          });
          if (ws.isPlaying()) { ws.pause(); icon(play, false); }
          else               { ws.play();  icon(play, true);  }
        };

        stop.onclick = () => { ws.pause(); ws.seekTo(0); icon(play, false); };
        rew.onclick  = () => { ws.seekTo(0); ws.play();  icon(play, true);  };

        players.set(play, ws);
        row.appendChild(td);
      });

      tbody.appendChild(row);
    });
  }

  /* ---------- PAGE INITIALISATION ---------- */
  (async () => {
    const shuffleBtn = document.getElementById('shuffle-sounds');

    let pool = await filterValid(await getIDs());
    let visible = rand(pool, ROWS);
    renderRows(visible);

    shuffleBtn.onclick = () => {
      visible = rand(pool, ROWS);
      renderRows(visible);
    };
  })();
  </script>
</body>
</html>